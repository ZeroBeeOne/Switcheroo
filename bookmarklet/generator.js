javascript:(function()%7B%0Avar THEBOOKMARKLET = function()%7B/*%0A// The host values must be hostnames (without protocol or trailing slashs)%0A// The mobile objects are comprised of type (qs for querystring or d for subdomain) and are arranged similar to Sams, mobile theme plugin%0A// for querystring use the entire string which would be used for mobile (eg 'v=m'), for subdomain use the subdomain without trailing dots (eg 'mobile')%0Avar HOSTS = %5B%5D;%0A%0Avar current_host = window.location.hostname;%0A%0A// I don't want to answer a dialog on every switch, so always just switch to the next item (or the first item from last)%0Avar redirected = false;%0Afor (var i=0;i<HOSTS.length;++i)%7B%0A%09var next;%0A%09if (current_host.search(HOSTS%5Bi%5D.hostname) != -1) %7B%0A%09%09if (i == HOSTS.length-1) %7B%0A%09%09%09next = 0;%0A%09%09%7D else %7B%0A%09%09%09next = ++i;%0A%09%09%7D%0A%09%09redirect(HOSTS%5Bi%5D, HOSTS%5Bnext%5D);%0A%09%09redirected = true;%0A%09%09break;%0A%09%7D%0A%7D%0A%0Aif (!redirected) %7B%0A%09console.log('I appear to be lost...');%0A%7D%0A%0Afunction checkForMobile(host) %7B%0A%09switch (host.mobile_type) %7B%0A%09%09case 'qs':%0A%09%09%09return getQueryString(host.mobile_val);%0A%09%09%09break;%0A%09%09case 'd':%0A%09%09%09return (current_host == host.mobile_val + '.' + host.hostname);%0A%09%09%09break;%0A%09%7D%0A%09return false;%0A%7D%0A%0Afunction getQueryString(qs) %7B%0A%09var url = window.location.href;%0A%09return (url.indexOf('?' + qs) != -1 %7C%7C url.indexOf('&' + qs) != -1 );%0A%7D%0A%0Afunction redirect(fromHost,toHost) %7B%0A%09var gotoUrl = window.location.protocol + '//',%0A%09%09path = window.location.href.replace(gotoUrl + window.location.host,'');%0A%09if (checkForMobile(fromHost)) %7B%0A%09%09if (toHost.mobile_type == 'd') %7B%0A%09%09%09// use the subdomain%0A%09%09%09gotoUrl += toHost.mobile_val + '.';%0A%09%09%7D%0A%09%09gotoUrl += toHost.hostname;%0A%09%09gotoUrl += path;%0A%09%09if (toHost.mobile_type == 'qs') %7B // TODO : fix double adding the querystring%0A%09%09%09if (gotoUrl.indexOf('?') == -1) %7B%0A%09%09%09%09gotoUrl += '?' + toHost.mobile_val;%0A%09%09%09%7D else %7B%0A%09%09%09%09gotoUrl += '&' + toHost.mobile_val;%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D else %7B%0A%09%09gotoUrl += toHost.hostname;%0A%09%09gotoUrl += path;%0A%09%7D%0A%09console.log("redirecting to " + gotoUrl + " (" + fromHost.ID + " -> " + toHost.ID + " )");%0A%09window.location.href = gotoUrl;%0A%7D%0A%0A*/%7D.toString().slice(14,-3);%0A%0Awindow.hostSwitcherGenerator = %7B%7D;%0A%0Awindow.hostSwitcherGenerator.root = document.createElement('div');%0Awindow.hostSwitcherGenerator.root.setAttribute('id', 'hostSwitcherGenerator');%0Adocument.getElementsByTagName('body')%5B0%5D.appendChild(window.hostSwitcherGenerator.root);%0A%0Aif (!window.jQuery) %7B%0A%09includeJQ();%0A%7D else %7B%0A%09init();%0A%7D%0A%0Afunction init() %7B%0A%09(function($) %7B%0A%09%09$('style:not(%5Bdisabled%5D), link%5Brel=stylesheet%5D:not(%5Bdisabled%5D)').attr('data-disabled-by-hostSwitcher', true).prop('disabled', true);%0A%09%09var css = '#hostSwitcherGenerator%7Bposition:fixed;top:10%25;right:10%25;width:80%25;height:80%25;background-color:#fff;z-index:9001;overflow:hidden;font-family:arial,sans-serif;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px%7D#hostSwitcherGenerator h1%7Bfont-size:18px;color:#000;display:block;text-align:center;padding-top:10px%7D#hostSwitcherGenerator ul%7Blist-style:none;margin:0;padding:10px;max-height:60%25;overflow-y:auto%7D#hostSwitcherGenerator ul li%7Bposition:relative;border-bottom:1px solid #000;margin:8px 0%7D#hostSwitcherGenerator ul li input%7B-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;padding:2px;margin-bottom:4px;width:80%25;height:20px%7D#hostSwitcherGenerator ul li input%5Bname=host_mobile_value%5D%7Bwidth:40%25%7D#hostSwitcherGenerator ul li select%7Bwidth:35%25;margin-right:5%25;height:20px%7D#hostSwitcherGenerator ul li button%7Bwidth:60px;height:60px;position:absolute;top:18px;right:5%25%7D';%0A%09%09$('#hostSwitcherGenerator').append('<style scoped type="text/css">' + css + '</style>');%0A%09%09$('<h1>Host switcher generator</h1>').appendTo('#hostSwitcherGenerator');%0A%09%09$('<ul></ul>').appendTo('#hostSwitcherGenerator');%0A%09%09$('<a href="#">The bookmarklet (click to refresh)</a>').appendTo('#hostSwitcherGenerator').on('click', refreshBookmarklet);%0A%09%09$('<button>X</button>').appendTo('#hostSwitcherGenerator');%0A%0A%09%09$item = $('<li><input placeholder="Host ID" name="host_ID" type="text" /><br /><input placeholder="Hostname" name="hostname" type="text" /><br /><select name="host_mobile_type"><option value="">Mobile Site Identifier...</option><option value="qs">QueryString</option><option value="d">Domain</option></select><input type="text" placeholder="Mobile Site Value" name="host_mobile_value" /><button>+</button></li>');%0A%09%09$item.appendTo('#hostSwitcherGenerator ul');%0A%0A%0A%09%09$('#hostSwitcherGenerator').on('click','ul li button',function()%7B%0A%09%09%09$item.clone().appendTo('#hostSwitcherGenerator ul');%0A%09%09%7D);%0A%09%09$('#hostSwitcherGenerator > button').on('click',destroy);%0A%0A%09%09function destroy() %7B // TODO should I perhaps be doing this on clickoutside too?%0A%09%09%09$('#hostSwitcherGenerator').remove();%0A%09%09%09$('style%5Bdata-disabled-by-hostSwitcher%5D, link%5Brel=stylesheet%5D%5Bdata-disabled-by-hostSwitcher%5D').prop('disabled', false).removeAttr('data-disabled-by-hostSwitcher');%0A%09%09%7D%0A%09%09function refreshBookmarklet(event) %7B%0A%09%09%09var HOSTS = %5B%5D, bmString;%0A%0A%09%09%09$('#hostSwitcherGenerator ul li').each(function(i,el)%7B%0A%09%09%09%09var thisRow = %7B%7D;%0A%09%09%09%09thisRow.ID = $('%5Bname=host_ID%5D', el).val();%0A%09%09%09%09thisRow.hostname = $('%5Bname=hostname%5D', el).val();%0A%09%09%09%09thisRow.mobile_type = $('%5Bname=host_mobile_type%5D', el).val();%0A%09%09%09%09thisRow.mobile_val = $('%5Bname=host_mobile_value%5D', el).val();%0A%09%09%09%09// TODO : some validation could go here to make sure the values have been entered, and are sane, but what am I gonna do, injection attack myself?%0A%09%09%09%09HOSTS.push(thisRow);%0A%09%09%09%7D);%0A%09%09%09bmString = THEBOOKMARKLET.replace("var HOSTS = %5B%5D;", "var HOSTS = " + JSON.stringify(HOSTS) + ";");%0A%09%09%09bmString = bookmarkletify(bmString);%0A%09%09%09$('#hostSwitcherGenerator > a').attr("href",bmString);%0A%09%09%09event.preventDefault();%0A%09%09%7D%0A%0A%09%7D)(jQuery);%0A%7D%0A%0A%0A%0Afunction includeJQ() %7B%0A%09getScript('http://code.jquery.com/jquery.min.js', function() %7B%0A%09%09if (typeof jQuery=='undefined') %7B%0A%09%09%09console.log("Couldn't load jQuery - giving up!");%0A%09%09%09// should do some cleanup here...%0A%09%09%7D else %7B%0A%09%09%09$.noConflict();%0A%09%09%09init();%0A%09%09%7D%0A%09%7D);%0A%7D%0A%0A%0A%0A%0A%0A%0A// HELPER FUNCTIONS%0A// Pretty much stolen as is from http://www.learningjquery.com/2009/04/better-stronger-safer-jquerify-bookmarklet/%0Afunction getScript(url,success)%7B%0A%09var script=document.createElement('script');%0A%09script.src=url;%0A%09var target=window.hostSwitcherGenerator.root,%0A%09done=false;%0A%09// Attach handlers for all browsers%0A%09script.onload=script.onreadystatechange = function()%7B%0A%09%09if ( !done && (!this.readyState%0A%09%09%7C%7C this.readyState == 'loaded'%0A%09%09%7C%7C this.readyState == 'complete') ) %7B%0A%09%09%09done=true;%0A%09%09%09success();%0A%09%09%09script.onload = script.onreadystatechange = null;%0A%09%09%7D%0A%09%7D;%0A%09target.appendChild(script);%0A%7D%0A%0A//These function were taken and modified slightly from http://ted.mielczarek.org/code/mozilla/bookmarklet.html, which originally modified them from brainjar.com . Ain't sharing grand?%0Afunction bookmarkletify(input) %7B%0A%0A%09var literalStrings;  // For temporary storage of literal strings.%0A%0A%09var output, i;%0A%0A%09// Get input script code, process it and display output.%0A%0A%09output = "(function() %7B%5Cn" + input + "%5Cn%7D)();";%0A%0A%09output = replaceLiteralStrings(output);%0A%0A%09output = removeComments(output);%0A%0A%09output = compressWhiteSpace(output);%0A%0A%09output = combineLiteralStrings(output);%0A%0A%09output = restoreLiteralStrings(output);%0A%0A%09// make the link%0A%09output = "javascript:" + output;%0A%0A%09return output;%0A%0A%09function replaceLiteralStrings(s) %7B%0A%0A%09%09var i, c, t, lines, escaped, quoteChar, inQuote, literal;%0A%0A%09%09literalStrings = new Array();%0A%09%09t = "";%0A%0A%09%09// Split script into individual lines.%0A%0A%09%09lines = s.split("%5Cn");%0A%09%09for (i = 0; i < lines.length; i++) %7B%0A%0A%09%09j = 0;%0A%09%09inQuote = false;%0A%09%09while (j <= lines%5Bi%5D.length) %7B%0A%09%09%09c = lines%5Bi%5D.charAt(j);%0A%0A%09%09%09// If not already in a string, look for the start of one.%0A%0A%09%09%09if (!inQuote) %7B%0A%09%09%09if (c == '"' %7C%7C c == "'") %7B%0A%09%09%09%09inQuote = true;%0A%09%09%09%09escaped = false;%0A%09%09%09%09quoteChar = c;%0A%09%09%09%09literal = c;%0A%09%09%09%7D%0A%09%09%09else%0A%09%09%09%09t += c;%0A%09%09%09%7D%0A%0A%09%09%09// Already in a string, look for end and copy characters.%0A%0A%09%09%09else %7B%0A%09%09%09%09if (c == quoteChar && !escaped) %7B%0A%09%09%09%09%09inQuote = false;%0A%09%09%09%09%09literal += quoteChar;%0A%09%09%09%09%09t += "__" + literalStrings.length + "__";%0A%09%09%09%09%09literalStrings%5BliteralStrings.length%5D = literal;%0A%09%09%09%09%7D%0A%09%09%09%09else if (c == "%5C%5C" && !escaped) %7B%0A%09%09%09%09%09escaped = true;%0A%09%09%09%09%7D%0A%09%09%09%09else %7B%0A%09%09%09%09%09escaped = false;%0A%09%09%09%09%7D%0A%09%09%09%09literal += c;%0A%09%09%09%7D%0A%09%09%09j++;%0A%09%09%7D%0A%09%09t += "%5Cn";%0A%09%09%7D%0A%0A%09%09return t;%0A%09%7D%0A%0A%09function removeComments(s) %7B%0A%0A%09%09var lines, i, t;%0A%0A%09%09// Remove '//' comments from each line.%0A%0A%09%09lines = s.split("%5Cn");%0A%09%09t = "";%0A%09%09for (i = 0; i < lines.length; i++)%0A%09%09t += lines%5Bi%5D.replace(/(%5B%5E%5Cx2f%5D*)%5Cx2f%5Cx2f.*$/, "$1");%0A%0A%09%09// Replace newline characters with spaces.%0A%0A%09%09t = t.replace(/(.*)%5Cn(.*)/g, "$1 $2");%0A%0A%09%09// Remove '/* ... */' comments.%0A%0A%09%09lines = t.split("*/");%0A%09%09t = "";%0A%09%09for (i = 0; i < lines.length; i++)%0A%09%09t += lines%5Bi%5D.replace(/(.*)%5Cx2f%5Cx2a(.*)$/g, "$1 ");%0A%0A%09%09return t;%0A%09%7D%0A%0A%09function compressWhiteSpace(s) %7B%0A%0A%09%09// Condense white space.%0A%0A%09%09s = s.replace(/%5Cs+/g, " ");%0A%09%09s = s.replace(/%5E%5Cs(.*)/, "$1");%0A%09%09s = s.replace(/(.*)%5Cs$/, "$1");%0A%0A%09%09// Remove uneccessary white space around operators, braces and parentices.%0A%0A%09%09s = s.replace(/%5Cs(%5B%5Cx21%5Cx25%5Cx26%5Cx28%5Cx29%5Cx2a%5Cx2b%5Cx2c%5Cx2d%5Cx2f%5Cx3a%5Cx3b%5Cx3c%5Cx3d%5Cx3e%5Cx3f%5Cx5b%5Cx5d%5Cx5c%5Cx7b%5Cx7c%5Cx7d%5Cx7e%5D)/g, "$1");%0A%09%09s = s.replace(/(%5B%5Cx21%5Cx25%5Cx26%5Cx28%5Cx29%5Cx2a%5Cx2b%5Cx2c%5Cx2d%5Cx2f%5Cx3a%5Cx3b%5Cx3c%5Cx3d%5Cx3e%5Cx3f%5Cx5b%5Cx5d%5Cx5c%5Cx7b%5Cx7c%5Cx7d%5Cx7e%5D)%5Cs/g, "$1");%0A%09%09return s;%0A%09%7D%0A%0A%09function combineLiteralStrings(s) %7B%0A%0A%09%09var i;%0A%0A%09%09s = s.replace(/"%5C+"/g, "");%0A%09%09s = s.replace(/'%5C+'/g, "");%0A%0A%09%09return s;%0A%09%7D%0A%0A%09function restoreLiteralStrings(s) %7B%0A%0A%09%09var i;%0A%0A%09%09for (i = 0; i < literalStrings.length; i++) %7B%0A%09%09%09s = s.replace(new RegExp("__" + i + "__"), literalStrings%5Bi%5D);%0A%09%09%7D%0A%0A%09%09return s;%0A%09%7D%0A%7D%0A%7D)();%0A
